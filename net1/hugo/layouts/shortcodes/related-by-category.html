{{- $theme := .Get "theme"}}
<div class="px1 px2l grid flex flex-grid flex-wrap flex-gutter-3">
{{- $page_link := $.Page.Permalink -}}
{{- $categories := $.Page.Params.categories -}}
{{- $c := 0 -}}
{{- range $page := .Site.Pages -}}
{{- $has_common_categories := intersect $categories .Params.categories | len | lt 0 -}}
{{- if and $has_common_categories (ne $page_link $page.Permalink) (lt ($.Scratch.Get "$c") 20)}}
{{- $.Scratch.Add "$c" 1 -}}

 <div class="w-33  flex flex-col-md mb2" >
  {{- $permalink := $page.RelPermalink -}}
  {{- with $page.Params.youtubeid -}}
  <div class="with-link {{with $theme}}{{.}}{{else}}gf9{{end}} thumb" >
   <div class="aspect sixteen-nine">hello
    <iframe src="https://www.youtube.com/embed/{{.}}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube Video"></iframe>
   </div>
   <a href="{{$permalink}}" class="link-over"></a>
  </div>
  {{- else -}}
  <div class="with-link {{with $theme}}{{.}}{{else}}gf9{{end}} thumb" >
   {{- $img := .Resources.GetMatch "*featured*" -}}
   {{- with $img -}}
   {{- $small := .Resize "600x" -}}
   <div class="aspect sixteen-nine ">
    <div><img class="abs cover" src="{{- $small.RelPermalink -}}" alt="{{- $img.Title -}}"></img></div>
   </div>
   <a href="{{$permalink}}" class="link-over"></a>
   {{- end -}}
  </div>
  {{- end -}}
  <div class="gf9 p1l px1 py050 flex flex-col justify-between flex1" >
   <div>
    <h5 class="mb050 lh13"><a class="inv " href="{{.Permalink}}">{{.Title}}</a>
    </h5>
    <p class="g8-text small hidden-sm ellipsis">{{.Description}}</p>
   </div>

   <ul class="unstyled vsmall " >
    <li><time class="vsmall " datetime="{{ dateFormat "2006-01-02T15:04:05-07:00" (default .Date (.Lastmod)) }}">
     {{ dateFormat "2 Jan, 2006" (default .Date (.Lastmod)) }}
     </time> | </li>
    {{ range .Params.categories }}<li class="com lh1"><a class="inv thin text-colour" href="/categories/{{ . | urlize }}/">{{ . }}</a></li>{{ end }}
   </ul>

  </div>

 </div>


{{- end -}}
{{- end -}}
</div>